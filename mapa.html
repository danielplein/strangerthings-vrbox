<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Stranger Things VR - Living Room Teleport</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #btn-start {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 1000; padding: 25px 50px; background: #b00; color: #fff;
            border: 3px solid #ff0000; font-family: monospace; font-weight: bold;
            font-size: 20px; cursor: pointer; border-radius: 10px;
        }
    </style>
</head>
<body>

    <button id="btn-start">ATIVAR VR & SENSORES</button>

    <a-scene vr-mode-ui="enabled: true" shadow="type: pcfsoft" fog="type: exponential; color: #080808; density: 0.1">
        
        <a-assets>
            <a-mixin id="teleport-ring" geometry="primitive: ring; radiusInner: 0.15; radiusOuter: 0.2" material="color: #00ff00; shader: flat" rotation="-90 0 0"></a-mixin>
        </a-assets>

        <a-entity id="rig" position="0 0 0">
            <a-camera id="cam" look-controls="enabled: true; magicWindowTrackingEnabled: true; touchEnabled: true">
                <a-entity cursor="fuse: true; fuseTimeout: 1500"
                          position="0 0 -1"
                          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                          material="color: white; shader: flat"
                          raycaster="objects: .floor, .target">
                    <a-animation begin="fusing" easing="ease-in" attribute="scale" fill="forwards" from="1 1 1" to="0.1 0.1 0.1" dur="1500"></a-animation>
                    <a-animation begin="mouseleave" attribute="scale" fill="backwards" to="1 1 1" dur="100"></a-animation>
                </a-entity>

                <a-entity id="leftHand" geometry="primitive: box; width: 0.1; height: 0.05; depth: 0.2" material="color: #ff0000; emissive: #ff0000; emissiveIntensity: 2" position="-0.4 -0.3 -0.7"></a-entity>
                <a-entity id="rightHand" geometry="primitive: box; width: 0.1; height: 0.05; depth: 0.2" material="color: #ff0000; emissive: #ff0000; emissiveIntensity: 2" position="0.4 -0.3 -0.7"></a-entity>
            </a-camera>
        </a-entity>

        <a-sky color="#020202"></a-sky>
        <a-plane class="floor" rotation="-90 0 0" width="30" height="30" color="#2b1a0f" shadow="receive: true"></a-plane>
        
        <a-box position="0 2.5 -6" width="12" height="5" depth="0.5" color="#d2b48c"></a-box> 
        <a-box position="-6 2.5 0" rotation="0 90 0" width="12" height="5" depth="0.5" color="#d2b48c"></a-box>
        <a-box position="6 2.5 0" rotation="0 90 0" width="12" height="5" depth="0.5" color="#d2b48c"></a-box>
        <a-box position="0 5 0" rotation="90 0 0" width="12" height="12" color="#1a110a"></a-box> <a-box position="0 0.5 -5.2" width="2" height="1" depth="1" color="#4a2c16"></a-box> <a-entity id="xmas-lights" position="0 4 -5.7"></a-entity>

        <a-entity id="mike" class="target" position="-2 0 -3" onclick="hit(this)">
            <a-box position="0 0.7 0" width="0.6" height="1.4" color="#34495e"></a-box>
            <a-sphere position="0 1.7 0" radius="0.3" color="#f3dbb3"></a-sphere>
        </a-entity>

        <a-entity id="dustin" class="target" position="2 0 -3" onclick="hit(this)">
            <a-box position="0 0.7 0" width="0.6" height="1.4" color="#2980b9"></a-box>
            <a-sphere position="0 1.7 0" radius="0.3" color="#f3dbb3"></a-sphere>
        </a-entity>

    </a-scene>

    <script>
        const rig = document.getElementById('rig');
        const btn = document.getElementById('btn-start');
        
        // 1. Corrigir Movimento da Câmera (Permissão de Sensores)
        btn.addEventListener('click', function() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            initGame();
                        }
                    })
                    .catch(console.error);
            } else {
                initGame();
            }
        });

        function initGame() {
            document.querySelector('a-scene').enterVR();
            btn.style.display = 'none';
        }

        // 2. Sistema de Teletransporte por Olhar
        document.querySelector('.floor').addEventListener('click', function (evt) {
            // evt.detail.intersection.point dá a coordenada exata onde o usuário olhou
            const newPos = evt.detail.intersection.point;
            rig.setAttribute('animation', {
                property: 'position',
                to: `${newPos.x} 0 ${newPos.z}`,
                dur: 300,
                easing: 'easeInQuad'
            });
        });

        // 3. Sistema de Ataque (Ao olhar fixamente para o personagem)
        function hit(el) {
            el.setAttribute('animation', 'property: scale; to: 1.2 1.2 1.2; dur: 100; dir: alternate; loop: 1');
            const box = el.querySelector('a-box');
            const originalColor = box.getAttribute('color');
            box.setAttribute('color', '#ff0000');
            setTimeout(() => box.setAttribute('color', originalColor), 300);
        }

        // Geração das Luzes de Natal
        const lightBox = document.getElementById('xmas-lights');
        const colors = ['#f00', '#ff0', '#00f', '#0f0', '#f0f'];
        for(let i=0; i<10; i++) {
            let l = document.createElement('a-sphere');
            l.setAttribute('position', `${(i-4.5)*1.2} 0 0`);
            l.setAttribute('radius', '0.07');
            l.setAttribute('color', colors[i%5]);
            l.setAttribute('light', `type: point; distance: 2; intensity: 1`);
            lightBox.appendChild(l);
        }
    </script>
</body>
</html>
